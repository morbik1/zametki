<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>–ú–æ–∏ –∑–∞–º–µ—Ç–∫–∏</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    @keyframes fadeIn {
      0% { opacity: 0; transform: scale(0.8) translateY(20px); }
      100% { opacity: 1; transform: scale(1) translateY(0); }
    }
    @keyframes fadeOut {
      0% { opacity: 1; transform: scale(1) translateY(0); }
      100% { opacity: 0; transform: scale(0.8) translateY(20px); }
    }
    .note {
      position: absolute;
      min-width: 200px;
      min-height: 120px;
      resize: both;
      overflow: auto;
      animation: fadeIn 0.3s ease forwards;
    }
    .note-header {
      background: rgba(0,0,0,0.05);
      padding: 4px 6px;
      cursor: grab;
      display: flex;
      justify-content: space-between;
      align-items: center;
      border-bottom: 1px solid rgba(0,0,0,0.1);
    }
    .note textarea {
      width: 100%;
      height: calc(100% - 30px);
      resize: none;
      outline: none;
      background: transparent;
      font-size: 15px;
      padding: 6px;
    }
    .pinned {
      box-shadow: 0 0 15px rgba(239, 68, 68, 0.6) !important;
    }
    .fade-out { animation: fadeOut 0.3s ease forwards; }
  </style>
</head>
<body class="bg-gradient-to-br from-blue-100 via-purple-100 to-pink-100 h-screen overflow-hidden">

  <!-- –ü–∞–Ω–µ–ª—å -->
  <div id="toolbar" class="bg-gradient-to-r from-blue-500 to-purple-500 text-white px-6 py-4 flex justify-between items-center shadow-lg">
    <h1 class="text-2xl font-bold tracking-wide">üìù –ú–æ–∏ –∑–∞–º–µ—Ç–∫–∏</h1>
    <div class="flex gap-2">
      <button id="prevPage" class="bg-white text-blue-600 font-semibold px-3 py-1 rounded-xl shadow hover:bg-gray-100">‚¨Ö</button>
      <button id="nextPage" class="bg-white text-blue-600 font-semibold px-3 py-1 rounded-xl shadow hover:bg-gray-100">‚û°</button>
      <button id="addNote" class="bg-white text-blue-600 font-semibold px-4 py-2 rounded-xl shadow-md hover:bg-gray-100 transition">
        + –ó–∞–º–µ—Ç–∫–∞
      </button>
    </div>
  </div>

  <!-- –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä —Å—Ç—Ä–∞–Ω–∏—Ü—ã -->
  <div class="fixed bottom-3 left-1/2 -translate-x-1/2 bg-white px-4 py-2 rounded-lg shadow-md font-semibold text-gray-700" id="pageIndicator"></div>

  <!-- –°–æ–æ–±—â–µ–Ω–∏—è -->
  <div id="messageBox" class="fixed top-4 left-1/2 -translate-x-1/2 bg-red-500 text-white px-4 py-2 rounded-lg shadow-md hidden"></div>

  <script>
    const toolbarHeight = document.getElementById('toolbar').offsetHeight;
    let data = JSON.parse(localStorage.getItem("notesApp")) || { pages: [[]], currentPage: 0 };

    function save() {
      localStorage.setItem("notesApp", JSON.stringify(data));
    }

    function showMessage(text) {
      const msg = document.getElementById("messageBox");
      msg.textContent = text;
      msg.classList.remove("hidden");
      setTimeout(() => msg.classList.add("hidden"), 3000);
    }

    function createNoteElement(note) {
      const div = document.createElement("div");
      div.className = "note rounded-xl shadow-xl bg-yellow-100";
      if (note.pinned) div.classList.add("pinned");

      div.style.left = note.x + "px";
      div.style.top = note.y + "px";
      div.style.width = note.width + "px";
      div.style.height = note.height + "px";

      // –®–∞–ø–∫–∞ –∑–∞–º–µ—Ç–∫–∏
      const header = document.createElement("div");
      header.className = "note-header";

      // –ö–Ω–æ–ø–∫–∏
      const btns = document.createElement("div");
      btns.className = "flex gap-2 text-lg";

      // –ü–∏–Ω
      const pin = document.createElement("span");
      pin.className = "cursor-pointer";
      pin.textContent = note.pinned ? "üìå" : "üìç";
      pin.onclick = () => {
        note.pinned = !note.pinned;
        save();
        render();
      };

      // –¶–≤–µ—Ç
      const color = document.createElement("span");
      color.className = "cursor-pointer";
      color.textContent = "üé®";
      color.onclick = () => {
        const colors = ["bg-yellow-100","bg-green-100","bg-pink-100","bg-blue-100","bg-purple-100"];
        let i = colors.indexOf(note.color || "bg-yellow-100");
        note.color = colors[(i+1) % colors.length];
        save();
        render();
      };

      // –ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ
      const copy = document.createElement("span");
      copy.className = "cursor-pointer text-blue-600";
      copy.textContent = "üìã";
      copy.onclick = async () => {
        try {
          await navigator.clipboard.writeText(note.text);
          showMessage("–¢–µ–∫—Å—Ç –∑–∞–º–µ—Ç–∫–∏ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω!");
        } catch (e) {
          showMessage("–û—à–∏–±–∫–∞ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è");
        }
      };

      // –£–¥–∞–ª–µ–Ω–∏–µ
      const del = document.createElement("span");
      del.className = "cursor-pointer text-red-500";
      del.textContent = "‚ùå";
      del.onclick = () => {
        data.pages[data.currentPage] = data.pages[data.currentPage].filter(n => n !== note);
        save();
        render();
      };

      btns.append(pin, color, copy, del);
      header.appendChild(btns);

      // –¢–µ–∫—Å—Ç
      const textarea = document.createElement("textarea");
      textarea.value = note.text;
      textarea.oninput = () => {
        note.text = textarea.value;
        save();
      };

      div.appendChild(header);
      div.appendChild(textarea);

      // –¶–≤–µ—Ç –∑–∞–º–µ—Ç–∫–∏
      div.className = "note rounded-xl shadow-xl " + (note.color || "bg-yellow-100");

      // –ü–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–Ω–∏–µ (—Ç–æ–ª—å–∫–æ –∑–∞ —à–∞–ø–∫—É)
      let offsetX, offsetY, isDragging = false;
      header.addEventListener("mousedown", (e) => {
        if (note.pinned) return;
        isDragging = true;
        offsetX = e.clientX - div.offsetLeft;
        offsetY = e.clientY - div.offsetTop;
        header.style.cursor = "grabbing";

        function onMouseMove(e) {
          if (!isDragging) return;
          let newX = e.clientX - offsetX;
          let newY = e.clientY - offsetY;
          if (newY < toolbarHeight) newY = toolbarHeight; 
          div.style.left = newX + "px";
          div.style.top = newY + "px";
        }

        function onMouseUp() {
          if (isDragging) {
            note.x = div.offsetLeft;
            note.y = div.offsetTop;
            save();
          }
          isDragging = false;
          header.style.cursor = "grab";
          document.removeEventListener("mousemove", onMouseMove);
          document.removeEventListener("mouseup", onMouseUp);
        }

        document.addEventListener("mousemove", onMouseMove);
        document.addEventListener("mouseup", onMouseUp);
      });

      // Resize —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ
      const observer = new ResizeObserver(() => {
        note.width = div.offsetWidth;
        note.height = div.offsetHeight;
        save();
      });
      observer.observe(div);

      return div;
    }

    function render(direction = null) {
      let existingNotes = document.querySelectorAll(".note");
      if (direction) {
        existingNotes.forEach(n => {
          n.classList.add("fade-out");
          setTimeout(() => n.remove(), 300);
        });
      } else {
        existingNotes.forEach(n => n.remove());
      }

      let notes = data.pages[data.currentPage];
      notes.forEach(note => {
        document.body.appendChild(createNoteElement(note));
      });
      document.getElementById("pageIndicator").textContent = `–°—Ç—Ä–∞–Ω–∏—Ü–∞ ${data.currentPage + 1} / ${data.pages.length}`;
    }

    // –î–æ–±–∞–≤–∏—Ç—å –∑–∞–º–µ—Ç–∫—É
    document.getElementById("addNote").onclick = () => {
      let newNote = { text: "", x: 120, y: toolbarHeight + 20, width: 220, height: 140, pinned: false, color: "bg-yellow-100" };
      data.pages[data.currentPage].push(newNote);
      save();
      render();
    };

    // –°—Ç—Ä–∞–Ω–∏—Ü—ã
    document.getElementById("prevPage").onclick = () => {
      if (data.currentPage > 0) {
        data.currentPage--;
        render("left");
        save();
      }
    };
    document.getElementById("nextPage").onclick = () => {
      let currentNotes = data.pages[data.currentPage];
      if (currentNotes.length < 5) {
        showMessage("–°–æ–∑–¥–∞–π—Ç–µ –º–∏–Ω–∏–º—É–º 5 –∑–∞–º–µ—Ç–æ–∫, –ø—Ä–µ–∂–¥–µ —á–µ–º –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç—å –¥–∞–ª—å—à–µ!");
        return;
      }
      if (currentNotes.some(n => !n.text.trim())) {
        showMessage("–ù–µ–æ–±—Ö–æ–¥–∏–º–æ, —á—Ç–æ–±—ã –≤ –∫–∞–∂–¥–æ–π –∑–∞–º–µ—Ç–∫–µ –±—ã–ª —Ç–µ–∫—Å—Ç!");
        return;
      }
      if (data.currentPage === data.pages.length - 1) {
        data.pages.push([]);
      }
      data.currentPage++;
      render("right");
      save();
    };

    render();
  </script>
</body>
</html>
